﻿<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Baldora - Videojuego educativo para aprender y practicar las tablas de multiplicar hasta 15x15">
    <title>Baldora - Arimética en línea</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="images/baldora_favicon.svg">


    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Nunito:wght@400;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- FileSaver.js -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- Driver.js - Onboarding Tours -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.3.1/dist/driver.css">
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.3.1/dist/driver.js.iife.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDe9UK69r-s0ZiFIb2fNtS_AOouv2bWBhE",
            authDomain: "baldora-89866.firebaseapp.com",
            databaseURL: "https://baldora-89866-default-rtdb.firebaseio.com",
            projectId: "baldora-89866",
            storageBucket: "baldora-89866.firebasestorage.app",
            messagingSenderId: "801097863804",
            appId: "1:801097863804:web:6526f17db5b8443d27eff9",
            measurementId: "G-RHWK9J2Z3S"
        };
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
    </script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Boton de Audio Toggle (Global) -->
    <button type="button" id="btn-audio-toggle" class="audio-toggle-btn" onclick="AudioManager.toggleMute()"
        title="Silenciar">&#128266;</button>

    <!-- Boton de Ayuda - Repetir Tour (Global) -->
    <button type="button" id="btn-help-tour" class="btn-help-tour" title="Ver tutorial">?</button>

    <!-- ===== VISTA DE CONFIGURACION (INICIO) ===== -->
    <section id="config-view" class="view active">
        <div class="config-container">
            <div class="logo-section">
                <img src="images/baldora_banner.png" alt="Baldora - Domina las tablas de multiplicar"
                    class="logo-banner">
            </div>

            <form id="config-form" class="config-form">
                <div class="form-group">
                    <label for="nickname">Tu Nickname</label>
                    <input type="text" id="nickname" name="nickname" placeholder="Ingresa tu nombre" required
                        maxlength="20">
                </div>

                <div class="form-group">
                    <label>Modo de Juego</label>
                    <div class="mode-selector mode-selector-3">
                        <input type="radio" id="mode-timer" name="game-mode" value="TIMER" checked>
                        <label for="mode-timer" class="mode-option">
                            <span class="mode-icon">&#9201;</span>
                            <span class="mode-name">Contrarreloj</span>
                            <span class="mode-desc">Tiempo límite</span>
                        </label>

                        <input type="radio" id="mode-free" name="game-mode" value="FREE">
                        <label for="mode-free" class="mode-option">
                            <span class="mode-icon">&#127919;</span>
                            <span class="mode-name">Práctica Libre</span>
                            <span class="mode-desc">Sin límite</span>
                        </label>

                        <input type="radio" id="mode-adaptive" name="game-mode" value="ADAPTIVE">
                        <label for="mode-adaptive" class="mode-option">
                            <span class="mode-icon">&#129504;</span>
                            <span class="mode-name">Adaptativo</span>
                            <span class="mode-desc">Entrena debilidades</span>
                        </label>
                    </div>
                </div>

                <div class="form-group timer-config" id="timer-config">
                    <label for="time-limit">Tiempo Límite (minutos)</label>
                    <div class="time-slider-container">
                        <input type="range" id="time-limit" name="time-limit" min="1" max="15" value="1">
                        <span class="time-display" id="time-display">1 min</span>
                    </div>
                </div>

                <div class="form-group" id="tables-config">
                    <div class="factors-selection-container">
                        <!-- Factor A (Filas) -->
                        <div class="factor-selector">
                            <div class="factor-header">
                                <label>TABLA Factor A (Filas)</label>
                                <button type="button" class="btn-select-all" id="btn-select-all-rows">Todas</button>
                            </div>
                            <div class="tables-selector" id="rows-selector">
                                <div class="tables-grid" id="rows-grid">
                                    <button type="button" class="table-btn active" data-table="1"
                                        data-type="row">1</button>
                                    <button type="button" class="table-btn" data-table="2" data-type="row">2</button>
                                    <button type="button" class="table-btn" data-table="3" data-type="row">3</button>
                                    <button type="button" class="table-btn" data-table="4" data-type="row">4</button>
                                    <button type="button" class="table-btn" data-table="5" data-type="row">5</button>
                                    <button type="button" class="table-btn" data-table="6" data-type="row">6</button>
                                    <button type="button" class="table-btn" data-table="7" data-type="row">7</button>
                                    <button type="button" class="table-btn" data-table="8" data-type="row">8</button>
                                    <button type="button" class="table-btn" data-table="9" data-type="row">9</button>
                                    <button type="button" class="table-btn" data-table="10" data-type="row">10</button>
                                    <button type="button" class="table-btn" data-table="11" data-type="row">11</button>
                                    <button type="button" class="table-btn" data-table="12" data-type="row">12</button>
                                    <button type="button" class="table-btn" data-table="13" data-type="row">13</button>
                                    <button type="button" class="table-btn" data-table="14" data-type="row">14</button>
                                    <button type="button" class="table-btn" data-table="15" data-type="row">15</button>
                                </div>
                            </div>
                        </div>

                        <!-- Factor B (Columnas) -->
                        <div class="factor-selector">
                            <div class="factor-header">
                                <label>TABLA Factor B (Columnas)</label>
                                <button type="button" class="btn-select-all" id="btn-select-all-cols">Todas</button>
                            </div>
                            <div class="tables-selector" id="cols-selector">
                                <div class="tables-grid" id="cols-grid">
                                    <button type="button" class="table-btn active" data-table="1"
                                        data-type="col">1</button>
                                    <button type="button" class="table-btn" data-table="2" data-type="col">2</button>
                                    <button type="button" class="table-btn" data-table="3" data-type="col">3</button>
                                    <button type="button" class="table-btn" data-table="4" data-type="col">4</button>
                                    <button type="button" class="table-btn" data-table="5" data-type="col">5</button>
                                    <button type="button" class="table-btn" data-table="6" data-type="col">6</button>
                                    <button type="button" class="table-btn" data-table="7" data-type="col">7</button>
                                    <button type="button" class="table-btn" data-table="8" data-type="col">8</button>
                                    <button type="button" class="table-btn" data-table="9" data-type="col">9</button>
                                    <button type="button" class="table-btn" data-table="10" data-type="col">10</button>
                                    <button type="button" class="table-btn" data-table="11" data-type="col">11</button>
                                    <button type="button" class="table-btn" data-table="12" data-type="col">12</button>
                                    <button type="button" class="table-btn" data-table="13" data-type="col">13</button>
                                    <button type="button" class="table-btn" data-table="14" data-type="col">14</button>
                                    <button type="button" class="table-btn" data-table="15" data-type="col">15</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info del modo adaptativo (oculto por defecto) -->
                <div class="form-group adaptive-info" id="adaptive-info" hidden>
                    <div class="adaptive-info-card">
                        <span class="adaptive-info-icon">&#128161;</span>
                        <div class="adaptive-info-text">
                            <strong>Modo Adaptativo</strong>
                            <p>Selecciona las tablas que deseas practicar. Completaras todas las operaciones de esas
                                tablas, y luego el sistema detectara tus debilidades y te entrenara hasta dominarlas.
                            </p>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-start">
                    <span>COMENZAR</span>
                    <span class="btn-arrow">&#8594;</span>
                </button>
            </form>
        </div>
        <div class="config-decoration"></div>
    </section>

    <!-- ===== VISTA DE JUEGO (GAMEPLAY) ===== -->
    <section id="game-view" class="view">
        <div class="game-container">
            <!-- Panel Izquierdo: Matriz -->
            <div class="matrix-panel">
                <div class="matrix-header">
                    <span class="matrix-title" id="matrix-title">Tabla de Multiplicar</span>
                    <span class="matrix-progress" id="matrix-progress">0 / 225</span>
                </div>
                <!-- Indicador de fase para modo adaptativo -->
                <div class="adaptive-phase-indicator" id="adaptive-phase" hidden>
                    <span class="phase-badge phase-diagnosis">&#128203; Fase Diagnostico</span>
                </div>
                <div class="matrix-grid" id="matrix-grid">
                    <!-- Grid generado por JS -->
                </div>
            </div>

            <!-- Panel Derecho: Controles -->
            <div class="controls-panel">
                <div class="timer-display" id="timer-display">
                    <span class="timer-label" id="timer-label">Tiempo</span>
                    <span class="timer-value" id="timer-value">05:00</span>
                </div>

                <div class="operation-display">
                    <div class="operation-card" id="operation-card">
                        <span class="factor" id="factor-a">?</span>
                        <span class="operator">x</span>
                        <span class="factor" id="factor-b">?</span>
                        <span class="equals">=</span>
                    </div>
                    <input type="number" id="answer-input" class="answer-input" placeholder="?" min="1" max="225"
                        autofocus>
                    <button type="button" class="btn-end" id="btn-end-session">
                        Terminar Sesion
                    </button>
                </div>

                <div class="stats-row">
                    <div class="stat-card stat-correct">
                        <span class="stat-icon">&#10003;</span>
                        <span class="stat-value" id="stat-correct">0</span>
                        <span class="stat-label">Aciertos</span>
                    </div>
                    <div class="stat-card stat-wrong">
                        <span class="stat-icon">&#10007;</span>
                        <span class="stat-value" id="stat-wrong">0</span>
                        <span class="stat-label">Errores</span>
                    </div>
                </div>

                <!-- Contador de debilidades restantes (modo adaptativo) -->
                <div class="weaknesses-counter" id="weaknesses-counter" hidden>
                    <span class="weaknesses-icon">&#127919;</span>
                    <span class="weaknesses-value" id="weaknesses-value">0</span>
                    <span class="weaknesses-label">Debilidades restantes</span>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== VISTA DE ANALITICAS (DASHBOARD) ===== -->
    <section id="dashboard-view" class="view">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h2 class="dashboard-title">&#128202; Analiticas de Sesion</h2>
                <div class="dashboard-actions">
                    <button type="button" class="btn-download" id="btn-download-csv">
                        &#128229; Descargar CSV
                    </button>
                    <button type="button" class="btn-secondary" id="btn-new-game">
                        Nueva Partida
                    </button>
                </div>
            </div>

            <div class="summary-cards">
                <div class="summary-card">
                    <span class="summary-icon">&#127919;</span>
                    <span class="summary-value" id="summary-total">0</span>
                    <span class="summary-label">Operaciones</span>
                </div>
                <div class="summary-card">
                    <span class="summary-icon">&#9989;</span>
                    <span class="summary-value" id="summary-correct">0</span>
                    <span class="summary-label">Correctas</span>
                </div>
                <div class="summary-card">
                    <span class="summary-icon">&#9889;</span>
                    <span class="summary-value" id="summary-avg-time">0ms</span>
                    <span class="summary-label">Tiempo Promedio</span>
                </div>
                <div class="summary-card">
                    <span class="summary-icon">&#128200;</span>
                    <span class="summary-value" id="summary-accuracy">0%</span>
                    <span class="summary-label">Precision</span>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Distribucion de Rendimiento</h3>
                    <div class="chart-container">
                        <canvas id="chart-pie"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Errores por Tabla</h3>
                    <div class="chart-container">
                        <canvas id="chart-bar-tables"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Top 5 Operaciones Dificiles</h3>
                    <div class="chart-container">
                        <canvas id="chart-bar-top"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Velocidad de Respuesta</h3>
                    <div class="chart-container">
                        <canvas id="chart-histogram"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== MODAL DE INACTIVIDAD ===== -->
    <div id="inactivity-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">&#9200;</div>
            <h2 class="modal-title">Sesion Pausada</h2>
            <p class="modal-message">El juego se reinicio por inactividad (30 segundos sin respuesta)</p>
            <button type="button" class="btn-modal" onclick="App.closeInactivityModal()">
                Volver al Inicio
            </button>
        </div>
    </div>

    <!-- ===== MODAL DE TRANSICION ADAPTATIVO ===== -->
    <div id="adaptive-transition-modal" class="modal-overlay">
        <div class="modal-content modal-adaptive">
            <div class="modal-icon">&#128269;</div>
            <h2 class="modal-title">Analisis Completado</h2>
            <p class="modal-message">Hemos detectado <strong id="weakness-count">0</strong> debilidades.</p>
            <p class="modal-submessage">Iniciando protocolo de correccion...</p>
            <button type="button" class="btn-modal" onclick="App.startTrainingPhase()">
                Comenzar Entrenamiento
            </button>
        </div>
    </div>

    <!-- ===== MODAL DE VICTORIA ADAPTATIVO ===== -->
    <div id="adaptive-victory-modal" class="modal-overlay">
        <div class="modal-content modal-victory">
            <div class="modal-icon">&#127942;</div>
            <h2 class="modal-title">Entrenamiento Completado!</h2>
            <p class="modal-message">Has dominado todas las operaciones problematicas.</p>
            <div class="victory-stats">
                <div class="victory-stat">
                    <span class="victory-stat-value" id="victory-initial">0</span>
                    <span class="victory-stat-label">Debilidades iniciales</span>
                </div>
                <div class="victory-stat">
                    <span class="victory-stat-value" id="victory-rounds">0</span>
                    <span class="victory-stat-label">Rondas completadas</span>
                </div>
                <div class="victory-stat">
                    <span class="victory-stat-value" id="victory-help-count">0</span>
                    <span class="victory-stat-label">Ayudas visuales</span>
                </div>
            </div>
            <button type="button" class="btn-modal" onclick="App.finishAdaptiveMode()">
                Ver Resultados
            </button>
        </div>
    </div>
    <!-- ===== FOOTER INSTITUCIONAL ===== -->
    <footer class="main-footer">
        <div class="footer-content">
            <!-- Marca con Logo -->
            <div class="footer-brand">
                <a href="https://www.instagram.com/jcg_games/" target="_blank" rel="noopener noreferrer"
                    aria-label="JCG Games en Instagram" class="brand-link"> <img src="images/jcg_logo.png"
                        alt="JCG Games Logo" class="brand-logo"><span class="brand-name">JCG Games</span></a>
            </div>

            <!-- Legal -->
            <div class="footer-legal">
                <span>© 2026 Baldora</span>
                <span class="separator"></span>
                <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer">MIT License</a>
                <span class="separator"></span>
                <span class="visit-counter">
                    <svg class="icon-visitors" viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                        <path
                            d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                    </svg>
                    <span id="visit-count">---</span>
                </span>
            </div>

            <!-- Social -->
            <div class="footer-social">
                <a href="https://github.com/juankeyboard/Baldora.git" target="_blank" rel="noopener noreferrer"
                    aria-label="Ver código en GitHub">
                    <svg class="icon-github" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor"
                        fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                        </path>
                    </svg>
                </a>
                <a href="https://www.instagram.com/baldoragame" target="_blank" rel="noopener noreferrer"
                    aria-label="Síguenos en Instagram">
                    <svg class="icon-instagram" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor"
                        fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                </a>
            </div>
        </div>
    </footer>


    <!-- Scripts -->
    <script src="js/audio.js"></script>
    <script src="js/data.js"></script>
    <script src="js/grid.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/onboarding.js"></script>
    <script src="js/visitor-counter.js"></script>
    <script src="js/app.js"></script>
</body>

</html>